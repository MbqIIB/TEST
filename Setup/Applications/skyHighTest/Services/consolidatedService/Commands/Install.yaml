harnessApiVersion: '1.0'
type: INSTALL
commandUnitType: COMMAND
commandUnits:
  - command: |-
        mkdir -p "$WINGS_RUNTIME_PATH"
        mkdir -p "$WINGS_BACKUP_PATH"
        mkdir -p "$WINGS_STAGING_PATH"
    commandUnitType: SETUP_ENV
    deploymentType: SSH
    name: Setup Runtime Paths
  - commandUnitType: COMMAND
    name: Stop
  - commandUnitType: SCP
    deploymentType: SSH
    destinationDirectoryPath: $WINGS_RUNTIME_PATH
    name: Copy App Stack
    source: APPLICATION_STACK
  - command: |-
        rm -rf tomcat
        rm -rf apache-tomcat-8.5.15
        tar xzvf apache-tomcat-8.5.15.tar.gz
        ln -s apache-tomcat-8.5.15 tomcat
        chmod +x tomcat/bin/*
    commandUnitType: EXEC
    deploymentType: SSH
    name: Expand App Stack
    workingDirectory: $WINGS_RUNTIME_PATH
  - commandUnitType: SCP
    deploymentType: SSH
    destinationDirectoryPath: $WINGS_RUNTIME_PATH
    name: Copy Artifact
    source: ARTIFACTS
  - command: tar -xvf $ARTIFACT_FILE_NAME -C tomcat/webapps/ --strip 1
    commandUnitType: EXEC
    deploymentType: SSH
    name: untar
    workingDirectory: $WINGS_RUNTIME_PATH
  - commandUnitType: COPY_CONFIGS
    deploymentType: SSH
    destinationParentPath: $WINGS_RUNTIME_PATH
    name: Copy Configs
  - commandUnitType: COMMAND
    name: Start
targetToAllEnv: true
