harnessApiVersion: '1.0'
type: STOP
commandUnitType: COMMAND
commandUnits:
  - command: '[ -f ./shutdown.sh ] && ./shutdown.sh  || true'
    commandUnitType: EXEC
    deploymentType: SSH
    name: Stop Service
    workingDirectory: $WINGS_RUNTIME_PATH/tomcat/bin
  - command: "i=0\nwhile [ \"$i\" -lt 30 ]\ndo\n                pgrep -f \"\\-Dcatalina.home=$WINGS_RUNTIME_PATH/tomcat\"\
        \   \n                rc=$?\n                if [ \"$rc\" -eq 0 ]\n          \
        \      then\n                                sleep 1\n                       \
        \         i=$((i+1))\n                else\n                                exit\
        \ 0\n                fi\ndone\nexit 1"
    commandUnitType: PROCESS_CHECK_STOPPED
    deploymentType: SSH
    name: Process Stopped
  - command: "set -x\nserver_xml=\"$WINGS_RUNTIME_PATH/tomcat/conf/server.xml\"\nif\
        \ [ -f \"$server_xml\" ]\nthen\nport=$(grep \"<Connector[ ]*port=\\\"[0-9]*\\\"\
        [ ]*protocol=\\\"HTTP/1.1\\\"\" \"$server_xml\" |cut -d '\"' -f2)\nnc -v -z -w\
        \ 5 localhost $port\nrc=$?\nif [ \"$rc\" -eq 0 ]    \nthen\nexit 1\nfi\nelse\n\
        \  echo \"Tomcat config file(\"$server_xml\") does not exist.. skipping port check.\"\
        \nfi"
    commandUnitType: PORT_CHECK_CLEARED
    deploymentType: SSH
    name: Port Cleared
targetToAllEnv: true
